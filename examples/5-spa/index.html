<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genes SPA Example</title>
    <link rel="stylesheet" href="../../genes.css">
    <style>
        .container { max-width: 64rem; margin: 2rem auto; padding: 0 1rem; }
        .task { 
            background: var(--bg-secondary); 
            padding: 1rem; 
            margin: 0.5rem 0; 
            border-radius: 0.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .task.completed { opacity: 0.6; text-decoration: line-through; }
        .stats { 
            background: var(--bg-tertiary); 
            padding: 1rem; 
            border-radius: 0.25rem;
            margin: 1rem 0;
            display: flex;
            gap: 2rem;
        }
        .stat { text-align: center; }
        .stat-value { font-size: 2rem; font-weight: bold; color: var(--primary); }
        .stat-label { font-size: 0.875rem; color: var(--text-muted); }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“‹ Todo List (SPA)</h1>
        <p>A single-page application built with Genes JS + REST API backend.</p>
        
        <!-- Stats -->
        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="totalTasks">0</div>
                <div class="stat-label">Total Tasks</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="completedTasks">0</div>
                <div class="stat-label">Completed</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="pendingTasks">0</div>
                <div class="stat-label">Pending</div>
            </div>
        </div>
        
        <!-- Add Task Form -->
        <div style="margin: 2rem 0;">
            <h2>Add New Task</h2>
            <form id="addTaskForm" style="display: flex; gap: 0.5rem;">
                <input type="text" id="taskInput" class="input" placeholder="Enter task..." 
                       style="flex: 1;" required>
                <button type="submit" class="btn btn-primary">Add Task</button>
            </form>
        </div>
        
        <!-- Tasks List -->
        <div>
            <h2>Tasks</h2>
            <div id="tasksList"></div>
            <p id="emptyMessage" style="color: var(--text-muted); display: none;">
                No tasks yet. Add your first task above!
            </p>
        </div>
    </div>

    <script src="../../genes.js"></script>
    <script>
        /*!
         * Todo List SPA
         * Frontend-only application using Genes JS
         */

        // ========================================================================
        // STATE
        // ========================================================================

        g.set("tasks", []);

        // ========================================================================
        // APP INITIALIZATION
        // ========================================================================

        g.def("app.init", function() {
            console.log("Initializing Todo SPA...");
            
            // Load tasks from localStorage
            g.run("app.loadTasks");
            
            // Render initial state
            g.run("app.render");
            
            // Setup event listeners
            g.run("app.setupEvents");
        });

        // ========================================================================
        // DATA MANAGEMENT
        // ========================================================================

        g.def("app.loadTasks", function() {
            var saved = g.ls.get("genes_tasks");
            if (saved) {
                g.set("tasks", saved);
            }
        });

        g.def("app.saveTasks", function() {
            var tasks = g.get("tasks");
            g.ls.set("genes_tasks", tasks);
        });

        g.def("app.addTask", function(title) {
            var tasks = g.get("tasks");
            var task = {
                id: g.now(),
                title: title,
                completed: false,
                createdAt: new Date().toISOString()
            };
            
            tasks.push(task);
            g.set("tasks", tasks);
            g.run("app.saveTasks");
            g.run("app.render");
        });

        g.def("app.toggleTask", function(id) {
            var tasks = g.get("tasks");
            var task = tasks.find(function(t) { return t.id === id; });
            
            if (task) {
                task.completed = !task.completed;
                g.set("tasks", tasks);
                g.run("app.saveTasks");
                g.run("app.render");
            }
        });

        g.def("app.deleteTask", function(id) {
            var tasks = g.get("tasks");
            tasks = tasks.filter(function(t) { return t.id !== id; });
            
            g.set("tasks", tasks);
            g.run("app.saveTasks");
            g.run("app.render");
        });

        // ========================================================================
        // UI RENDERING
        // ========================================================================

        g.def("app.render", function() {
            g.run("app.renderTasks");
            g.run("app.renderStats");
        });

        g.def("app.renderTasks", function() {
            var tasks = g.get("tasks");
            var container = g.el("#tasksList");
            var emptyMessage = g.el("#emptyMessage");
            
            if (tasks.length === 0) {
                container.innerHTML = "";
                emptyMessage.style.display = "block";
                return;
            }
            
            emptyMessage.style.display = "none";
            container.innerHTML = "";
            
            tasks.forEach(function(task) {
                var taskEl = g.create("div", {
                    className: "task" + (task.completed ? " completed" : ""),
                    innerHTML: [
                        '<div>',
                        '  <input type="checkbox" ' + (task.completed ? 'checked' : '') + ' data-id="' + task.id + '" class="task-checkbox">',
                        '  <span>' + g.encode(task.title) + '</span>',
                        '</div>',
                        '<button class="btn btn-sm task-delete" data-id="' + task.id + '">Delete</button>'
                    ].join('')
                });
                
                container.appendChild(taskEl);
            });
        });

        g.def("app.renderStats", function() {
            var tasks = g.get("tasks");
            var completed = tasks.filter(function(t) { return t.completed; }).length;
            var pending = tasks.length - completed;
            
            g.el("#totalTasks").textContent = tasks.length;
            g.el("#completedTasks").textContent = completed;
            g.el("#pendingTasks").textContent = pending;
        });

        // ========================================================================
        // EVENT HANDLERS
        // ========================================================================

        g.def("app.setupEvents", function() {
            // Add task form
            g.on("submit", "#addTaskForm", function(form, e) {
                e.preventDefault();
                
                var input = g.el("#taskInput");
                var title = input.value.trim();
                
                if (title) {
                    g.run("app.addTask", title);
                    input.value = "";
                    input.focus();
                }
            });
            
            // Toggle task checkbox
            g.on("change", ".task-checkbox", function(checkbox) {
                var id = parseInt(checkbox.getAttribute("data-id"));
                g.run("app.toggleTask", id);
            });
            
            // Delete task button
            g.on("click", ".task-delete", function(button) {
                var id = parseInt(button.getAttribute("data-id"));
                g.run("app.deleteTask", id);
            });
        });

        // ========================================================================
        // START APP
        // ========================================================================

        g.que("onReady", function() {
            g.run("app.init");
        });
    </script>
</body>
</html>
